<html>
    <head>
        <link type="text/css" rel="stylesheet" href="css/bootstrap.css"/>
        <title>What The Fuck is on?</title>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script src="js/underscore.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/backbone.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/moment.js" type="text/javascript" charset="utf-8"></script>
        
        <!-- Models -->
        <script src="js/movieModel.js" type="text/javascript" charset="utf-8"></script>
        
        <!-- Models -->
        <script src="js/moviesCollection.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="fake-response.js" type="text/javascript" charset="utf-8"></script>

        <script type="text/javascript" charset="utf-8" async defer>
        

        var kinos = {};
        var movies = {};


        var moviesToday = new MoviesCollection();

        var today = moment();

       
        // var moviesCollection = new MoviesCollection();

        var totalShowings = 0;

        $( document ).ready( function( )
        {
            $.ajax(
            {
                type : 'get',
                dataType: 'json',
                contentType: "application/json",
                url  : 'http://fidgetmag.co.uk/berlin/cinemas/today'
            } ).then( function( resp, a, xhr ) {
                // var date = new date( xhr.getResponseHeader('Date') );

                kinos = resp.cinemas;
                movies = resp.movies;

                moviesToday.add( movies, { parse: true} );



                //get todays movies
                moviesToday.each( function( movie ) 
                {
                    var timesArray  = movie.get( 'showTimes' );
                    var movieList   = $( '.moviesToday' );
                    var extraClasses = '';

                        if( movie.get( 'original' ) )
                        {
                            extraClasses = ' js-has-omu';
                        }
                        else
                        {
                            extraClasses = ' hide';
                        }

                        var uriTitle = encodeURIComponent( movie.get('title') );

                        var youTubeLink = ' <a href="http://www.youtube.com/results?search_query=' + uriTitle + '&page=&utm_source=opensearch" class="youTube-Link" target="_blank">'
                                    + ' yT</a>';
 
                        movieList.append( '<li class="js-movie  movie ' + extraClasses + '">' + movie.get( 'title' ) + youTubeLink + '</li>' );


                });


                var movieStat = $( '.stats__movies' );

                movieStat.text( moviesToday.length + ' movies');

                // Add classes


                // Filter Omu
                var omuButton =  $( '.js-filters__omu' );

                omuButton.click( function ( e )
                {

                    var movieLis = $( '.js-movie' );
                    var omuListings = $( '.js-has-omu' );

                    e.preventDefault();

                    if( omuButton.hasClass( 'js-showAll' ) )
                    {
                        omuButton.text( 'Only Original Language' );
                        movieLis.removeClass( 'hide' );
                        movieStat.text( movieLis.length + ' fucking movies' );
                        omuButton.removeClass( 'js-showAll' );
                    }
                    else
                    {
                        omuButton.text( 'Show All Movies' );
                        omuButton.addClass( 'js-showAll' );

                        movieLis.addClass( 'hide' );
                        omuListings.removeClass( 'hide' );

                        movieStat.text( omuListings.length + ' fucking movies' );
                        
                    }


                });

                // omuButton.trigger( 'click' );
            } );





        });
</script>
    </head>
    <body> 
        <div class="page">
            <h1>Here is what the fuck is on today:</h1>
            <ul class="stats">
                <li class="stats__movies"></li>
            </ul>
            <ul class="filters">
                <li class="filters__omu"><a href="" class="fuckingButton js-showAll js-filters__omu">Show All Movies</a></li>
            </ul>
            <ul class="moviesToday">
                
            </ul>
            
        </div>
        
        
    </body>
</html>