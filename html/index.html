<html>
    <head>
        <link type="text/css" rel="stylesheet" href="css/bootstrap.css"/>
        <title>What The Fuck is on?</title>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script src="js/underscore.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/backbone.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/moment.js" type="text/javascript" charset="utf-8"></script>
        
        <!-- Models -->
        <script src="js/movieModel.js" type="text/javascript" charset="utf-8"></script>
        
        <!-- Models -->
        <script src="js/moviesCollection.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="fake-response.js" type="text/javascript" charset="utf-8"></script>

        <script type="text/javascript" charset="utf-8" async defer>
        

        var kinos = {};
        var movies = {};


        var moviesToday = new MoviesCollection();

        var today = moment();

       
        var moviesCollection = new MoviesCollection();

        var totalShowings = 0;

        $( document ).ready( function( )
        {
            $.ajax(
            {
                type : 'get',
                dataType: 'json',
                contentType: "application/json",
                url  : 'http://fidgetmag.co.uk/berlin/cinemas/'
            } ).then( function( resp, a, xhr ) {
                // var date = new date( xhr.getResponseHeader('Date') );

                kinos = resp.cinemas;
                movies = resp.movies;

                moviesCollection.add( movies, { parse: true} );
        




                //get todays movies
                moviesCollection.each( function( movie ) 
                {
                    // console.log( movie.get( 'title') );
                    var timesArray  = movie.get( 'showTimes' );
                    var movieList   = $( '.moviesToday' );
                    var extraClasses = '';

                    _.find( timesArray, function( time, i )
                    {
                        if( movie.get( 'title' ).search( 'OmU' ) > 0 )
                        {
                            extraClasses = ' js-has-omu';
                        }
                        else
                        {
                            extraClasses = '';
                        }

                        if( time.isSame( today, 'day' ) )
                        {
                            moviesToday.add( movie );   
                            movieList.append( '<li class="js-movie  movie ' + extraClasses + '">' + movie.get( 'title' ) + '</li>' );

                            return true;
                        } 
                    } );

                });


                var movieStat = $( '.stats__movies' );

                movieStat.text( moviesToday.length + ' movies');

                // Add classes


                // Filter Omu
                var omuButton =  $( '.js-filters__omu' );

                omuButton.click( function ( e )
                {

                    var movieLis = $( '.js-movie' );
                    var omuListings = $( '.js-has-omu' );

                    e.preventDefault();

                    movieLis.addClass( 'hide' );
                    omuListings.removeClass( 'hide' );

                    movieStat.text( omuListings.length + ' movies' );

                });
            } );





        });
</script>
    </head>
    <body> 
        <div class="page">
            <h1>Here is what the fuck is on today:</h1>
            <ul class="stats">
                <li class="stats__movies"></li>
            </ul>
            <ul class="filters">
                <li class="filters__omu"><a href="" class="js-filters__omu">Only OmU</a></li>
            </ul>
            <ul class="moviesToday">
                
            </ul>
            
        </div>
        
        
    </body>
</html>